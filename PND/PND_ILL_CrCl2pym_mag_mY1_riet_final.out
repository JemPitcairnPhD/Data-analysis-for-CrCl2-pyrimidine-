 
'--------------------------------------------------------------
'Input File for simple Rietveld Refinement
'Use save/set current button then run with F6 in topas
'Replace $ and # symbols with text/numbers as needed
'--------------------------------------------------------------

r_wp  46.1099528 r_exp  42.7882555 r_p -132.850318 r_wp_dash  46.1099528 r_p_dash  48.6231237 r_exp_dash  42.7882555 weighted_Durbin_Watson  1.56999205 gof  1.07763105

'--------------------------------------------------------------
'General information about refinement here
'Remove comments as required
'--------------------------------------------------------------

iters 10000
chi2_convergence_criteria 0.001
do_errors

'--------------------------------------------------------------
'Information on datafile etc here
'Check that default weighting is appropriate for your data
'--------------------------------------------------------------
xdd PND_ILL_CrCl2pym_1p5K-30K.xye
	start_X 9
	exclude 45 50
	finish_X 75
	x_calculation_step = Yobs_dx_at(Xo); convolution_step 4
	lam ymin_on_ymax 0.0001 la 1.0 lo 2.52 lh 0.5 
				neutron_data
				LP_Factor( 90)                                                                                              
                                     

prm gam   2.27866`_0.15399
prm x0  1.26127`_0.04821
prm sc  1.64851`_0.08479 min 0
fit_obj =  -1*(    (0.5*gam)/(  (4*Pi*Sin(X*Pi/360)/Lam-x0)^2 + (0.5*gam)^2)   )*sc;    
prm c_length = 2*Pi/gam;:2.75740`_0.18634

	str
		TCHZ_Peak_Type(!pku,-0.60691_0.74367_LIMIT_MIN_-0.806906539,!pkv, -1.00000_0.58130_LIMIT_MIN_-1,!pkw,  0.15630_0.09337,!pkz, 0.0000,!pky, 0.44217_0.16260_LIMIT_MIN_0.242173149,!pkxz, 0.0000)
		Simple_Axial_Model(!axial, 17.66983_0.46295)                     
		phase_name CrCl2pym
		CS_L(@, 49.84372`_6.13407)
		'Topas .str file generated by ISODISTORT
		'Remember to add the appropriate peak shape line when passing this into an input file

		mag_space_group 14.82 'transformPp a,b,c;0,0,0
		a     7.055808
		b    12.100077
		c     =3.659642*2;:7.319284
		al   90.00000
		be   93.09226
		ga   90.00000
		scale  =  0.133831327 / 4;:0.0334578318
		prm csize  17.67767`_2.64673 '
		prm csize101 = If(And(H==1, K==0, L==1), csize, 10000);:10000.00000`
			lor_fwhm = 0.1 57.2957795130823 Lam / (Cos(Th) (csize101));	:0.00182040986`
		
		prm csize2  25.68845`_4.92330 'min 0 max 10
		prm csize121 = If(And(H==1, K==2, L^2==1), csize2, 10000);:10000.00000`
			lor_fwhm = 0.1 57.2957795130823 Lam / (Cos(Th) (csize121));	:0.00182040986`


'{{{mode definitions
		prm  mm1  -2.99897`_0.08542 min  -8.00 max  8.00 'P2_1/m[1/2,0,0]mY1-(a)[Cr01:d:mag]Ag_1(a)
		prm  mm2  4.35037`_0.11969 min  -8.00 max  8.00 'P2_1/m[1/2,0,0]mY1-(a)[Cr01:d:mag]Ag_2(a)
		prm  !mm3  0.00000 min  -8.00 max  8.00 'P2_1/m[1/2,0,0]mY1-(a)[Cr01:d:mag]Ag_3(a)
'}}}

'{{{mode-amplitude to delta transformation
		prm  Cr01_1_dmlx = +  0.07079*mm1+  0.00524*mm2;: -0.18950`_0.00608
		prm  Cr01_1_dmly = -  0.04131*mm3;: -0.00000
		prm  Cr01_1_dmlz = +  0.06833*mm2;:  0.29726`_0.00818
'}}}



'{{{distorted parameters
		prm !Cr01_1_x    = 1/2;:  0.50000
		prm !Cr01_1_y    = 0;:  0.00000
		prm !Cr01_1_z    = 0;:  0.00000
		prm !Cl02_1_x    =    0.72019;:  0.72019
		prm !Cl02_1_y    =    0.57595;:  0.57595
		prm !Cl02_1_z    =    0.73057;:  0.73057
		prm !N003_1_x    =    0.65520;:  0.65520
		prm !N003_1_y    =    0.34805;:  0.34805
		prm !N003_1_z    =    0.50770;:  0.50770
		prm !C004_1_x    =    0.56930;:  0.56930
		prm !C004_1_y    = 1/4;:  0.25000
		prm !C004_1_z    =    0.51620;:  0.51620
		prm !H004_1_x    =    0.43928;:  0.43928
		prm !H004_1_y    = 1/4;:  0.25000
		prm !H004_1_z    =    0.52909;:  0.52909
		prm !C005_1_x    =    0.84400;:  0.84400
		prm !C005_1_y    =    0.34727;:  0.34727
		prm !C005_1_z    =   -0.01050;: -0.01050
		prm !H005_1_x    =    0.90813;:  0.90813
		prm !H005_1_y    =    0.41411;:  0.41411
		prm !H005_1_z    =   -0.01698;: -0.01698
		prm !C006_1_x    =    0.94420;:  0.94420
		prm !C006_1_y    = 1/4;:  0.25000
		prm !C006_1_z    =   -0.01970;: -0.01970
		prm !H006_1_x    =    0.07433;:  0.07433
		prm !H006_1_y    = 1/4;:  0.25000
		prm !H006_1_z    =   -0.03165;: -0.03165

		prm  Cr01_1_mlx  = 0  + Cr01_1_dmlx;: -0.18950`_0.00608
		prm  Cr01_1_mly  = 0  + Cr01_1_dmly;:  0.00000
		prm  Cr01_1_mlz  = 0  + Cr01_1_dmlz;:  0.29726`_0.00818

		prm !Cr01_1_occ  = 1;:  1.00000
		prm !Cl02_1_occ  = 1;:  1.00000
		prm !N003_1_occ  = 1;:  1.00000
		prm !C004_1_occ  = 1;:  1.00000
		prm !H004_1_occ  = 1;:  1.00000
		prm !C005_1_occ  = 1;:  1.00000
		prm !H005_1_occ  = 1;:  1.00000
		prm !C006_1_occ  = 1;:  1.00000
		prm !H006_1_occ  = 1;:  1.00000
'}}}

'{{{mode-dependent sites
   mag_only_for_mag_sites
prm !mag_scale 1
		site Cr01_1    num_posns  4  x = Cr01_1_x;:0.50000 y = Cr01_1_y;:0.00000 z = Cr01_1_z;:0.00000 occ Cr     = Cr01_1_occ;:1.00000 beq 0
			mlx = Cr01_1_mlx*mag_scale;   mly = Cr01_1_mly*mag_scale;   mlz = Cr01_1_mlz*mag_scale;
			MM_CrystalAxis_Display( -1.33708`_0.04289, 0.00000, 2.17574`_0.05986)
			MM_Cartesian_Display( -1.45445`_0.04268, 0.00000`_0.00000, 2.17257`_0.05977) 
	   site Cl02_1    num_posns  8  x = Cl02_1_x;:0.72019 y = Cl02_1_y;:0.57595 z = Cl02_1_z;:0.73057 occ Cl   0 beq 0.0' = Cl02_1_occ;:1.00000 
	   site N003_1    num_posns  8  x = N003_1_x;:0.65520 y = N003_1_y;:0.34805 z = N003_1_z;:0.50770 occ N    0 beq 0.0' = N003_1_occ;:1.00000 
	   site C004_1    num_posns  4  x = C004_1_x;:0.56930 y = C004_1_y;:0.25000 z = C004_1_z;:0.51620 occ C    0 beq 0.0' = C004_1_occ;:1.00000 
	   site H004_1    num_posns  4  x = H004_1_x;:0.43928 y = H004_1_y;:0.25000 z = H004_1_z;:0.52909 occ H    0 beq 0.0' = H004_1_occ;:1.00000 
	   site C005_1    num_posns  8  x = C005_1_x;:0.84400 y = C005_1_y;:0.34727 z = C005_1_z;:-0.01050 occ C   0 beq 0.0'  = C005_1_occ;:100000 
	   site H005_1    num_posns  8  x = H005_1_x;:0.90813 y = H005_1_y;:0.41411 z = H005_1_z;:-0.01698 occ H   0 beq 0.0'  = H005_1_occ;:100000 
	   site C006_1    num_posns  4  x = C006_1_x;:0.94420 y = C006_1_y;:0.25000 z = C006_1_z;:-0.01970 occ C   0 beq 0.0'  = C006_1_occ;:100000 
	   site H006_1    num_posns  4  x = H006_1_x;:0.07433 y = H006_1_y;:0.25000 z = H006_1_z;:-0.03165 occ H   0 beq 0.0'  = H006_1_occ;:100000 

		site origin    num_posns  4  x  0.00000       y  0.00000       z  0.00000       occ D  0
'}}}

prm !ax = Constant(Get(a)); 
prm !bx = Constant(Get(b)*Cos(Get(ga)*0.01745329251994));
prm by = Constant(Get(b)*Sin(Get(ga)*0.01745329251994)); 
prm !cx = Constant(Get(c)*Cos(Get(be)*0.01745329251994)); 
prm !cy = Constant(Get(c)*(Cos(Get(al)*0.01745329251994) - Cos(Get(be) 0.01745329251994)*Cos(Get(ga)*0.01745329251994)) / Sin(Get(ga)*0.01745329251994));
prm !cz = Constant(Sqrt(Get(c)^2 - cx^2 - cy^2));
prm Mx = Cr01_1_mlx*mag_scale*ax + Cr01_1_mly*mag_scale*bx +Cr01_1_mlz*mag_scale*cx; : -1.45445`_0.04268
prm My = Cr01_1_mly*mag_scale*by + Cr01_1_mlz*mag_scale*cy; :  0.00000`_0.00000
prm Mz = Cr01_1_mlz*mag_scale*cz; :  2.17257`_0.05977
prm modM = (Mx^2+My^2+Mz^2)^0.5; :  2.61448`_0.05445

prm sc_err= 0.001451/0.133831327;:0.01084`
prm modM_prop_err = Sqrt((0.05445/modM)^2+sc_err^2)*modM ;:0.06139`_0.00027
prm modM_prop_err_percent = Sqrt((0.05445/modM)^2+sc_err^2)*100 ;:2.34795`_0.03847
/*
view_structure
xdd_out PND_ILL_CrCl2pym_mag_mY1_final.dat load out_record out_fmt out_eqn
{
       " %11.5f  " = X;
       " %11.5f  " = Yobs;
       " %11.5f  " = Ycalc;
       " %11.5f\n" = Yobs-Ycalc;
   }
Out_CIF_mag_MJC(PND_ILL_CrCl2pym_mag_mY1_final.mcif)
 out PND_ILL_CrCl2pym_mag_mY1_final_rug_marks.dat
      Out_String("\tHKL reflection markers:\n")

      for strs {
        phase_out PND_ILL_CrCl2pym_mag_mY1_final_rug_marks.dat  load out_record out_fmt out_eqn
        {
           " %3.0f" = H;
           " %3.0f" = K;
           " %3.0f" = L;
           " %3.0f" = M;
            " %11.5f"   = 2* Pi/D_spacing;
           " %11.5f"   = D_spacing;
           " %11.5f\n"   = 2 Rad Th;
        }
      }
   }
C_matrix_normalized
{
                             1   2   3   4   5   6   7   8
gam                    1:  100 -43  78  17  -1   5  10 -24
x0                     2:  -43 100 -25 -19  -4 -12   2  50
sc                     3:   78 -25 100 -17  -5  -7 -17  13
m63834ea8_4            4:   17 -19 -17 100  -0  -2  63 -33
csize                  5:   -1  -4  -5  -0 100   6   4 -10
csize2                 6:    5 -12  -7  -2   6 100  -2 -33
mm1                    7:   10   2 -17  63   4  -2 100  12
mm2                    8:  -24  50  13 -33 -10 -33  12 100
}
*/
C_matrix_normalized
{
                             1   2   3   4   5   6   7   8
gam                    1:  100 -43  78  17  -1   5  10 -24
x0                     2:  -43 100 -25 -19  -4 -12   2  50
sc                     3:   78 -25 100 -17  -5  -7 -17  13
m63874593_126          4:   17 -19 -17 100  -0  -2  63 -33
csize                  5:   -1  -4  -5  -0 100   6   4 -10
csize2                 6:    5 -12  -7  -2   6 100  -2 -33
mm1                    7:   10   2 -17  63   4  -2 100  12
mm2                    8:  -24  50  13 -33 -10 -33  12 100
}